import{s as M,g as se,a as g,E as L,j as s,C as ae,h as re,f as ne,i as oe,e as ie,A as le,k as ce,L as y,I as w,B as S,D as de,l as me,m as ue,n as pe,o as he,p as fe}from"./index-B8JqZxCy.js";function ge(e){switch(String(e||"").toLowerCase()){case"super_admin":return"/superadmin/setup";case"admin":return"/admin/plots";case"staff":return"/staff/dashboard/";default:return"/visitor/home"}}function xe(e){return String(e).replace(/\/+$/,"")}async function ye(e){if((e.headers.get("content-type")||"").includes("application/json"))try{return await e.json()}catch{return null}try{return await e.text()}catch{return null}}async function we({usernameOrEmail:e,password:t}){const r=xe("https://sementeryo-backend.onrender.com/api");if(!r)throw new Error("Missing VITE_API_BASE_URL in frontend/.env");console.log("API BASE:",r);const c=`${r}/auth/login`;try{const n=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({usernameOrEmail:e,password:t})}),i=await ye(n);if(!n.ok){const h=i&&typeof i=="object"&&(i.error||i.message)||typeof i=="string"&&i||`Login failed (${n.status})`,d=new Error(h);throw d.status=n.status,d.data=i,d}const o=i?.token||null,a=i?.user||null;return o&&a&&M({token:o,user:a}),{token:o,user:a,next:ge(a?.role)}}catch(n){const i=n?.message||String(n),o=new Error(`Login request failed.
URL: ${c}
Reason: ${i}`);throw o.cause=n,o}}function be(e){switch(String(e||"").toLowerCase()){case"super_admin":return"/superadmin/dashboard";case"admin":return"/admin/dashboard";case"staff":return"/staff/dashboard/";default:return"/visitor/home"}}function je(e){return String(e).replace(/\/+$/,"")}async function ve(e){if((e.headers.get("content-type")||"").includes("application/json"))try{return await e.json()}catch{return null}try{return await e.text()}catch{return null}}async function Se({username:e,email:t,password:r,first_name:c,last_name:n,phone:i,address:o}){const a=je("https://sementeryo-backend.onrender.com/api");if(!a)throw new Error("Missing VITE_API_BASE_URL in frontend/.env");const h=`${a}/auth/register`;try{const d=await fetch(h,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({username:e,email:t,password:r,first_name:c,last_name:n,phone:i||null,address:o||null})}),l=await ve(d);if(!d.ok){const N=l&&typeof l=="object"&&(l.error||l.message)||typeof l=="string"&&l||`Sign up failed (${d.status})`,b=new Error(N);throw b.status=d.status,b.data=l,b}const m=l?.token||null,x=l?.user||(l&&typeof l=="object"?l:null);m&&x&&M({token:m,user:x});const k=m&&x?be(x.role):"/visitor/home";return{token:m,user:x,next:k}}catch(d){const l=d?.message||String(d),m=new Error(`Signup request failed.
URL: ${h}
Reason: ${l}`);throw m.cause=d,m}}class E{constructor(t=0,r="Network Error"){this.status=t,this.text=r}}const Ee=()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}},u={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:Ee()},_=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{},ke=(e,t="https://api.emailjs.com")=>{if(!e)return;const r=_(e);u.publicKey=r.publicKey,u.blockHeadless=r.blockHeadless,u.storageProvider=r.storageProvider,u.blockList=r.blockList,u.limitRate=r.limitRate,u.origin=r.origin||t},V=async(e,t,r={})=>{const c=await fetch(u.origin+e,{method:"POST",headers:r,body:t}),n=await c.text(),i=new E(c.status,n);if(c.ok)return i;throw i},H=(e,t,r)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||typeof t!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!r||typeof r!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},Pe=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},$=e=>e.webdriver||!e.languages||e.languages.length===0,K=()=>new E(451,"Unavailable For Headless Browser"),Ne=(e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof t!="string")throw"The BlockList watchVariable has to be a string"},Le=e=>!e.list?.length||!e.watchVariable,_e=(e,t)=>e instanceof FormData?e.get(t):e[t],J=(e,t)=>{if(Le(e))return!1;Ne(e.list,e.watchVariable);const r=_e(t,e.watchVariable);return typeof r!="string"?!1:e.list.includes(r)},U=()=>new E(403,"Forbidden"),Ce=(e,t)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&typeof t!="string")throw"The LimitRate ID has to be a non-empty string"},Te=async(e,t,r)=>{const c=Number(await r.get(e)||0);return t-Date.now()+c},q=async(e,t,r)=>{if(!t.throttle||!r)return!1;Ce(t.throttle,t.id);const c=t.id||e;return await Te(c,t.throttle,r)>0?!0:(await r.set(c,Date.now().toString()),!1)},W=()=>new E(429,"Too Many Requests"),Oe=async(e,t,r,c)=>{const n=_(c),i=n.publicKey||u.publicKey,o=n.blockHeadless||u.blockHeadless,a=n.storageProvider||u.storageProvider,h={...u.blockList,...n.blockList},d={...u.limitRate,...n.limitRate};return o&&$(navigator)?Promise.reject(K()):(H(i,e,t),Pe(r),r&&J(h,r)?Promise.reject(U()):await q(location.pathname,d,a)?Promise.reject(W()):V("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:i,service_id:e,template_id:t,template_params:r}),{"Content-type":"application/json"}))},Re=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},Ae=e=>typeof e=="string"?document.querySelector(e):e,De=async(e,t,r,c)=>{const n=_(c),i=n.publicKey||u.publicKey,o=n.blockHeadless||u.blockHeadless,a=u.storageProvider||n.storageProvider,h={...u.blockList,...n.blockList},d={...u.limitRate,...n.limitRate};if(o&&$(navigator))return Promise.reject(K());const l=Ae(r);H(i,e,t),Re(l);const m=new FormData(l);return J(h,m)?Promise.reject(U()):await q(location.pathname,d,a)?Promise.reject(W()):(m.append("lib_version","4.4.1"),m.append("service_id",e),m.append("template_id",t),m.append("user_id",i),V("/api/v1.0/email/send-form",m))},F={init:ke,send:Oe,sendForm:De,EmailJSResponseStatus:E},I=L.EMAILJS_SERVICE_ID,B=L.EMAILJS_TEMPLATE_ID,P=L.EMAILJS_PUBLIC_KEY;function Ie(){const e=se(),[t,r]=g.useState(!0),[c,n]=g.useState(!1),[i,o]=g.useState({type:"",text:""}),[a,h]=g.useState({usernameOrEmail:"",password:"",username:"",email:"",confirmPassword:"",first_name:"",last_name:"",phone:""}),[d,l]=g.useState(!1),[m,x]=g.useState(""),[k,N]=g.useState(""),[b,Y]=g.useState(0),[v,C]=g.useState(!1),T=Math.max(0,b-Date.now()),z=Math.ceil(T/1e3),G=T<=0;g.useEffect(()=>{P&&F.init(P)},[]);const j=p=>{o({type:"",text:""}),h(f=>({...f,[p.target.name]:p.target.value}))},Q=()=>{r(p=>!p),o({type:"",text:""}),h({usernameOrEmail:"",password:"",username:"",email:"",confirmPassword:"",first_name:"",last_name:"",phone:""})};function X(){return String(Math.floor(1e5+Math.random()*9e5))}function O(p){return new Date(p).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}async function R(p){if(!P||!I||!B){o({type:"error",text:"Email verification is not configured (missing EmailJS env vars). Please contact the administrator."});return}const f=X(),A=Date.now()+900*1e3;C(!0);try{await F.send(I,B,{email:p,passcode:f,time:O(A)},{publicKey:P}),N(f),Y(A),x(""),l(!0),o({type:"ok",text:"We sent a 6-digit code to your email. Enter it below to continue."})}catch(D){o({type:"error",text:D?.text||D?.message||"Could not send verification email. Please try again."})}finally{C(!1)}}async function Z(p){p.preventDefault(),o({type:"",text:""});try{if(n(!0),t){if(!a.usernameOrEmail||!a.password){o({type:"error",text:"Please enter email/username and password."});return}const{next:f}=await we({usernameOrEmail:a.usernameOrEmail.trim(),password:a.password});e(f)}else{if(!a.username||!a.email||!a.password||!a.first_name||!a.last_name){o({type:"error",text:"Please complete all required fields."});return}if(a.password!==a.confirmPassword){o({type:"error",text:"Passwords do not match."});return}await R(a.email.trim())}}catch(f){o({type:"error",text:f?.message||"Something went wrong."})}finally{n(!1)}}async function ee(){if(!k){o({type:"error",text:"No OTP generated. Please resend."});return}if(Date.now()>b){o({type:"error",text:"The code has expired. Please resend."});return}if(m.trim()!==k){o({type:"error",text:"Incorrect code. Please try again."});return}try{n(!0);const{token:p,next:f}=await Se({username:a.username.trim(),email:a.email.trim(),password:a.password,first_name:a.first_name.trim(),last_name:a.last_name.trim(),phone:a.phone.trim(),address:null});p?e(f):(o({type:"ok",text:"Account created! Please sign in."}),r(!0),h({usernameOrEmail:a.email,password:"",username:"",email:"",confirmPassword:"",first_name:"",last_name:"",phone:""})),l(!1)}catch(p){o({type:"error",text:p?.message||"Sign up failed."})}finally{n(!1)}}async function te(){a.email&&await R(a.email.trim())}return s.jsxs("div",{className:"relative min-h-screen flex items-center justify-center font-poppins px-4",children:[s.jsxs("div",{"aria-hidden":!0,className:"pointer-events-none fixed inset-0 -z-10",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-100 via-cyan-50 to-blue-100"}),s.jsx("div",{className:"absolute -top-24 -left-24 h-[32rem] w-[32rem] rounded-full bg-emerald-300/50 blur-3xl dark:bg-emerald-500/10"}),s.jsx("div",{className:"absolute top-1/3 right-0 h-[28rem] w-[28rem] rounded-full bg-cyan-300/50 blur-3xl dark:bg-cyan-700/20"}),s.jsx("div",{className:"absolute -bottom-32 left-1/4 h-[24rem] w-[24rem] rounded-full bg-blue-300/40 blur-3xl dark:bg-blue-700/20"})]}),s.jsxs("div",{className:"relative w-full max-w-md",children:[s.jsx("div",{className:"absolute -inset-2 bg-gradient-to-br from-emerald-400/25 via-cyan-400/20 to-blue-400/25 rounded-3xl blur-xl opacity-40"}),s.jsxs(ae,{className:"relative overflow-hidden w-full rounded-3xl border-white/60 dark:border-white/10 bg-white/80 dark:bg-white/5 backdrop-blur supports-[backdrop-filter]:bg-white/40 shadow-2xl",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-400/20 via-cyan-400/15 to-blue-400/20"}),s.jsxs(re,{className:"relative space-y-1",children:[s.jsx(ne,{className:"text-2xl text-slate-900",children:t?"Sign In":"Create Account"}),s.jsx(oe,{className:"text-slate-600",children:t?"Enter your credentials to access your account":"Fill in your details to get started"})]}),s.jsxs(ie,{className:"relative",children:[i.text?s.jsx(le,{className:`mb-4 backdrop-blur shadow-md ${i.type==="error"?"bg-rose-50/90 border-rose-200":"bg-emerald-50/90 border-emerald-200"}`,children:s.jsx(ce,{className:i.type==="error"?"text-rose-700":"text-emerald-700",children:i.text})}):null,s.jsxs("form",{className:"space-y-4",onSubmit:Z,children:[!t&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"username",children:"Username"}),s.jsx(w,{id:"username",type:"text",name:"username",value:a.username,onChange:j,placeholder:"johndoe",autoComplete:"username"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"first_name",children:"First Name"}),s.jsx(w,{id:"first_name",type:"text",name:"first_name",value:a.first_name,onChange:j,placeholder:"John",autoComplete:"given-name"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"last_name",children:"Last Name"}),s.jsx(w,{id:"last_name",type:"text",name:"last_name",value:a.last_name,onChange:j,placeholder:"Doe",autoComplete:"family-name"})]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:t?"usernameOrEmail":"email",children:t?"Email or Username":"Email Address"}),s.jsx(w,{id:t?"usernameOrEmail":"email",type:t?"text":"email",name:t?"usernameOrEmail":"email",value:t?a.usernameOrEmail:a.email,onChange:j,placeholder:t?"you@example.com or johndoe":"you@example.com",autoComplete:"email"})]}),!t&&s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"phone",children:"Phone Number"}),s.jsx(w,{id:"phone",type:"tel",name:"phone",value:a.phone,onChange:j,placeholder:"+63 912 345 6789",autoComplete:"tel"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"password",children:"Password"}),s.jsx(w,{id:"password",type:"password",name:"password",value:a.password,onChange:j,placeholder:"••••••••",autoComplete:t?"current-password":"new-password"})]}),!t&&s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"confirmPassword",children:"Confirm Password"}),s.jsx(w,{id:"confirmPassword",type:"password",name:"confirmPassword",value:a.confirmPassword,onChange:j,placeholder:"••••••••",autoComplete:"new-password"})]}),t&&s.jsx("div",{className:"flex justify-end",children:s.jsx(S,{type:"button",variant:"link",className:"px-0 text-emerald-600",onClick:()=>o({type:"ok",text:"Please contact the administrator to reset your password."}),children:"Forgot your password?"})}),s.jsx(S,{type:"submit",disabled:c||v,className:"w-full shadow-md hover:shadow-lg transition-all",children:c||v?t?"Signing in…":v?"Sending code…":"Creating…":t?"Sign In":"Create Account"})]}),s.jsxs("div",{className:"mt-6 text-center text-sm",children:[s.jsxs("span",{className:"text-slate-600",children:[t?"Don't have an account?":"Already have an account?"," "]}),s.jsx(S,{variant:"link",onClick:Q,className:"p-0",children:t?"Sign up here!":"Sign in here!"})]})]})]})]}),s.jsx(de,{open:d,onOpenChange:l,children:s.jsxs(me,{className:"sm:max-w-md bg-white/90 backdrop-blur border-white/60 shadow-2xl",children:[s.jsxs(ue,{children:[s.jsx(pe,{children:"Email Verification"}),s.jsxs(he,{children:["Enter the 6-digit code we sent to ",s.jsx("b",{children:a.email||"your email"}),"."]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"otp",children:"One-Time Password (OTP)"}),s.jsx(w,{id:"otp",inputMode:"numeric",pattern:"[0-9]*",maxLength:6,value:m,onChange:p=>x(p.target.value.replace(/\D/g,"")),placeholder:"123456"}),s.jsx("p",{className:"text-xs text-slate-500",children:G?"Code expired.":`Code expires in ${z}s (valid until ${O(b)}).`})]}),s.jsxs(fe,{className:"flex items-center justify-between gap-2",children:[s.jsx(S,{type:"button",variant:"secondary",onClick:te,disabled:v,className:"shadow-md hover:shadow-lg transition-all",children:v?"Sending…":"Resend Code"}),s.jsx(S,{type:"button",onClick:ee,disabled:c,className:"shadow-md hover:shadow-lg transition-all",children:"Verify & Create Account"})]})]})})]})}export{Ie as default};
