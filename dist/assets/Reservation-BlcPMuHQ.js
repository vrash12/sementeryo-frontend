import{q as he,a,t as es,v as h,j as e,T as lt,N as ws,C as Q,h as X,f as ee,w as rt,i as se,B as m,R as Te,x as it,y as U,A as te,z as ae,k as le,e as ue,L as F,I as T,M as Ee,F as nt,G as I,H as dt,J as ys,K as re,O as as,Q as Os,D as _s,l as Ss,m as Cs,n as ks,o as Ps,p as Rs}from"./index-B8JqZxCy.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ss=he("arrow-left",ot);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],_=he("arrow-right",ct);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],ye=he("cloud-upload",mt);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],ut=he("file-image",xt);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Ms=he("file-text",ht);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],Ds=he("shield-alert",pt),V=typeof import.meta<"u"&&"https://sementeryo-backend.onrender.com/api"||"",bt=typeof import.meta<"u"&&"https://sementeryo-backend.onrender.com"||V,ts="reservationDraft_v3";function ft(){if(typeof window>"u")return null;const r=localStorage.getItem("auth");if(!r)return null;try{return JSON.parse(r)}catch{return null}}function gt(r){return r?.accessToken||r?.token||r?.jwt||""}function vt(r,l){const x=String(r||"").trim();return x?x>String(l||""):!1}function jt(r,l){const x=String(r||"").trim(),i=String(l||"").trim();return!x||!i?!1:x<i}const Nt=r=>{if(!r)return null;try{return new URL(r,bt.replace(/\/+$/,"")+"/").toString()}catch{return r}},wt=({plotId:r,reservationId:l,deceasedName:x})=>{const i=new URLSearchParams;return r!=null&&i.set("plot_id",String(r)),l!=null&&i.set("reservation_id",String(l)),x&&i.set("deceased_name",String(x)),`/visitor/inquire?${i.toString()}`},Ne={plots:`${V}/plot/`,reservePlot:`${V}/visitor/reserve-plot`,myReservations:`${V}/visitor/my-reservations`,cancelReservation:r=>`${V}/visitor/cancel-reservation/${encodeURIComponent(r)}`,uploadReceipt:r=>`${V}/visitor/reservations/${encodeURIComponent(r)}/upload-receipt`};function Ie(r){if(r==null||r==="")return"—";const l=Number(r);return Number.isNaN(l)?String(r):l.toLocaleString(void 0,{maximumFractionDigits:2})}function As(){const r=new Date,l=r.getTimezoneOffset()*6e4;return new Date(r.getTime()-l).toISOString().slice(0,10)}function z(r){const l=String(r||"").toLowerCase();return l==="available"?{label:"Available",className:"bg-emerald-600 hover:bg-emerald-600"}:l==="reserved"?{label:"Reserved",className:"bg-amber-500 hover:bg-amber-500"}:l==="occupied"?{label:"Occupied",className:"bg-rose-600 hover:bg-rose-600"}:l==="pending"?{label:"Pending",className:"bg-amber-500 hover:bg-amber-500"}:l==="approved"?{label:"Approved",className:"bg-emerald-600 hover:bg-emerald-600"}:l==="rejected"?{label:"Rejected",className:"bg-rose-600 hover:bg-rose-600"}:l==="cancelled"||l==="canceled"?{label:"Cancelled",className:"bg-slate-500 hover:bg-slate-500"}:{label:r||"—",className:"bg-slate-500 hover:bg-slate-500"}}function Ls(r){try{if(!r?.geometry)return null;const l=r.geometry;if(l.type==="Point"){const[f,w]=l.coordinates||[];return typeof w=="number"&&typeof f=="number"?[w,f]:null}const x=[];if(l.type==="Polygon"){const f=l.coordinates?.[0]||[];for(const[w,P]of f)typeof P=="number"&&typeof w=="number"&&x.push({lat:P,lng:w})}else if(l.type==="MultiPolygon")for(const f of l.coordinates||[]){const w=f?.[0]||[];for(const[P,ie]of w)typeof ie=="number"&&typeof P=="number"&&x.push({lat:ie,lng:P})}else return null;if(!x.length)return null;let i=x[0].lat,y=x[0].lat,N=x[0].lng,b=x[0].lng;for(const{lat:f,lng:w}of x)f<i&&(i=f),f>y&&(y=f),w<N&&(N=w),w>b&&(b=w);return[(i+y)/2,(N+b)/2]}catch{return null}}function L(r,l){const x=String(l||"").trim();return x?`${r}: ${x}`:null}async function we(r,l){const x=await fetch(r,l),y=(x.headers.get("content-type")||"").includes("application/json")?await x.json().catch(()=>({})):await x.text().catch(()=>"");if(!x.ok){const N=typeof y=="string"?y:y?.message||y?.error||`HTTP ${x.status}`;throw new Error(N)}return y}function yt({step:r}){const l=[{n:1,label:"Enter details",icon:U,hint:"Visitor & deceased info"},{n:2,label:"Pick on map",icon:Ee,hint:"Select an available plot"},{n:3,label:"Confirm & submit",icon:as,hint:"Review then submit"},{n:4,label:"Upload receipt",icon:ye,hint:"Upload proof & wait"}],x=l.length<=1?100:Math.round((Math.max(1,Math.min(r,l.length))-1)/(l.length-1)*100);return e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Progress"}),e.jsxs("div",{className:"rounded-full border bg-white/70 px-2.5 py-1 text-xs font-semibold text-slate-700",children:["Step ",r,"/",l.length]})]}),e.jsx("div",{className:"h-2 w-full rounded-full bg-slate-200/80 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-emerald-600 transition-all duration-500",style:{width:`${x}%`}})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-2",children:l.map(i=>{const y=i.icon,N=r===i.n,b=r>i.n;return e.jsx("div",{className:["group rounded-2xl border p-3 transition-all","bg-white/75 backdrop-blur",b?"border-emerald-200 shadow-sm":N?"border-blue-200 shadow-sm ring-1 ring-blue-200/60":"border-slate-200 hover:border-slate-300 hover:shadow-sm"].join(" "),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:["grid h-10 w-10 place-items-center rounded-2xl border transition",b?"bg-emerald-100 border-emerald-200 text-emerald-700":N?"bg-blue-100 border-blue-200 text-blue-700":"bg-slate-50 border-slate-200 text-slate-700 group-hover:bg-slate-100"].join(" "),children:b?"✓":e.jsx(y,{className:"h-4 w-4"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-[10px] text-slate-500",children:["Step ",i.n]}),e.jsx("div",{className:"text-sm font-semibold text-slate-900 truncate",children:i.label}),e.jsx("div",{className:"text-[11px] text-slate-500 truncate",children:i.hint})]})]})},i.n)})})]})}function _t(){return e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-slate-600",children:[e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border bg-white px-3 py-1",children:[e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-emerald-500"}),"Available"]}),e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border bg-white px-3 py-1",children:[e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-amber-400"}),"Reserved"]}),e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border bg-white px-3 py-1",children:[e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-rose-500"}),"Occupied"]}),e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border bg-white px-3 py-1",children:[e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-blue-500"}),"Selected"]})]})}function qe({label:r,value:l,dotClass:x}){return e.jsxs("div",{className:"flex items-center justify-between gap-3 rounded-2xl border bg-white/70 px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-600",children:[e.jsx("span",{className:["h-2.5 w-2.5 rounded-full",x].join(" ")}),r]}),e.jsx("div",{className:"text-sm font-bold text-slate-900 tabular-nums",children:l})]})}function St({status:r,hasReceipt:l}){const x=String(r||"").toLowerCase(),b=[{title:"Submitted",desc:"Reservation sent to admin",done:!!r,icon:as},{title:"Receipt uploaded",desc:"Payment proof submitted for review",done:!!l,icon:ye},{title:"Approved",desc:"Admin approved your request",done:x==="approved",icon:Os}];return e.jsxs("div",{className:"rounded-2xl border bg-white p-4",children:[e.jsx("div",{className:"text-sm font-bold text-slate-900",children:"Progress"}),e.jsx("div",{className:"mt-3 space-y-3",children:b.map((f,w)=>{const P=f.icon;return e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:["mt-0.5 h-8 w-8 rounded-2xl border grid place-items-center",f.done?"bg-emerald-100 border-emerald-200 text-emerald-700":"bg-slate-50 border-slate-200 text-slate-600"].join(" "),children:e.jsx(P,{className:"h-4 w-4"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:f.title}),e.jsx("div",{className:"text-xs text-slate-500",children:f.done?"Done":"Pending"})]}),e.jsx("div",{className:"text-xs text-slate-500",children:f.desc}),w!==b.length-1?e.jsx("div",{className:"mt-3 h-px w-full bg-slate-200/70"}):null]})]},f.title)})}),x==="rejected"?e.jsxs("div",{className:"mt-4 rounded-2xl border bg-rose-50 p-3 text-sm text-rose-900",children:[e.jsx("div",{className:"font-semibold",children:"Rejected"}),e.jsx("div",{className:"text-xs text-rose-800 mt-1",children:"Please contact the admin for details."})]}):null]})}function Ct(r,l){const x=String(r||"").trim(),i=String(l||"").trim();return`${x} ${i}`.trim()||""}function Pt(){const r=a.useMemo(()=>ft(),[]),l=a.useMemo(()=>gt(r),[r]),x=r?.user?.role||null,i=!!(r?.user&&x==="visitor"),y=a.useMemo(()=>{const s={"Content-Type":"application/json"};return l&&(s.Authorization=`Bearer ${l}`),s},[l]),N=a.useMemo(()=>As(),[]),b=r?.user||{},f=a.useMemo(()=>{const s=b.full_name||b.name||b.profile_name||Ct(b.first_name,b.last_name)||b.username||b.email||"";return String(s||"").trim()},[b]),w=a.useMemo(()=>String(b.email||"").trim(),[b]),P=a.useMemo(()=>String(b.phone||b.contact_number||b.contact||b.mobile||"").trim(),[b]),ie=a.useMemo(()=>String(b.address||"").trim(),[b]),[O,ne]=a.useState({relationship:"",contact_number:"",address:""}),[c,Y]=a.useState({full_name:"",date_of_death:"",date_of_burial:"",age:"",remarks:""}),[de,Fs]=a.useState(null),[oe,ls]=a.useState(!1),[rs,Be]=a.useState(""),is=a.useMemo(()=>vt(c.date_of_burial,N),[c.date_of_burial,N]),ns=a.useMemo(()=>jt(c.date_of_burial,c.date_of_death),[c.date_of_burial,c.date_of_death]),$e=a.useMemo(()=>{const s=c.date_of_death||"";return s?s>N:!1},[c.date_of_death,N]),[_e,Ts]=a.useState([]),[H,ds]=a.useState(!1),[p,R]=a.useState(1),[d,ce]=a.useState(null),[pe,Se]=a.useState(""),[o,q]=a.useState(null),[S,J]=a.useState(null),[E,os]=a.useState(!1),[ze,cs]=a.useState(""),[B,Ue]=a.useState(!0),[Is,A]=a.useState(!1),[C,Ce]=a.useState(!1),[qs,ke]=a.useState(!1),[ms,xs]=a.useState(null),[us,Ve]=a.useState("Idle"),[Es,G]=a.useState(es),[Bs,W]=a.useState(19),me=a.useRef(null),Ye=a.useRef(null),[$s,He]=a.useState(!1),u=a.useMemo(()=>{const s=String(O.contact_number||P||"").trim(),t=String(O.address||ie||"").trim(),n=String(O.relationship||"").trim();return{full_name:f,email:w,contact_number:s,address:t,relationship:n,_source:{hasProfilePhone:!!P,hasProfileAddress:!!ie}}},[O,P,ie,w,f]);a.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[p]),a.useEffect(()=>{try{const s=localStorage.getItem(ts);if(!s)return;const t=JSON.parse(s);if(t?.applicantMeta?ne(n=>({...n,...t.applicantMeta})):t?.applicant&&ne(n=>({...n,relationship:t?.applicant?.relationship??n.relationship,contact_number:t?.applicant?.contact_number??n.contact_number,address:t?.applicant?.address??n.address})),t?.deceased){const n={...t.deceased},j=As();n.date_of_death&&String(n.date_of_death)>j&&(n.date_of_death=""),Y(g=>({...g,...n}))}typeof t?.notes=="string"&&Se(t.notes),typeof t?.onlyAvailable=="boolean"&&Ue(t.onlyAvailable),Ve("Restored")}catch{}},[]);const be=a.useRef(null);a.useEffect(()=>(be.current&&clearTimeout(be.current),be.current=setTimeout(()=>{try{localStorage.setItem(ts,JSON.stringify({applicantMeta:O,deceased:c,notes:pe,onlyAvailable:B,savedAt:new Date().toISOString()})),Ve("Saved")}catch{}},450),()=>{be.current&&clearTimeout(be.current)}),[O,c,pe,B]);const hs=s=>{s&&J(s)},zs=s=>s?.type==="FeatureCollection"?s:s?.data?.type==="FeatureCollection"?s.data:s,K=a.useCallback(async()=>{if(!V){Be("Missing VITE_API_BASE_URL. Please configure your .env.");return}ls(!0),Be("");try{const s=l?{Authorization:`Bearer ${l}`}:{},t=await we(Ne.plots,{headers:s});Fs(zs(t))}catch(s){Be(s?.message||"Failed to load plots.")}finally{ls(!1)}},[l]),M=a.useCallback(async()=>{if(!i)return[];ds(!0);try{const s=await we(Ne.myReservations,{headers:l?{Authorization:`Bearer ${l}`}:{}}),t=Array.isArray(s)?s:s?.data||[],n=Array.isArray(t)?t:[];return Ts(n),n}catch(s){return h.error(s?.message||"Failed to load reservations."),[]}finally{ds(!1)}},[i,l]);a.useEffect(()=>{K()},[K]),a.useEffect(()=>{M()},[M]);const fe=a.useMemo(()=>de?.features?de.features.map(s=>{const t=s.properties||{},n=Ls(s);return{id:t.id!=null?String(t.id):void 0,uid:t.uid!=null?String(t.uid):void 0,plot_name:t.plot_name??t.plot_code??"—",plot_type:t.plot_type??"—",size_sqm:t.size_sqm??"—",price:t.price??null,status:t.status??"—",lat:n?n[0]:null,lng:n?n[1]:null,_feature:s}}).filter(Boolean):[],[de]),Pe=a.useMemo(()=>{const s={available:0,reserved:0,occupied:0,total:fe.length};for(const t of fe){const n=String(t.status||"").toLowerCase();n==="available"?s.available++:n==="reserved"?s.reserved++:n==="occupied"&&s.occupied++}return s},[fe]),Je=a.useMemo(()=>{const s=ze.trim().toLowerCase();return fe.filter(t=>B&&String(t.status||"").toLowerCase()!=="available"?!1:s?String(t.id||"").toLowerCase().includes(s)||String(t.uid||"").toLowerCase().includes(s)||String(t.plot_name||"").toLowerCase().includes(s)||String(t.plot_type||"").toLowerCase().includes(s)||String(t.status||"").toLowerCase().includes(s)||String(t.price??"").toLowerCase().includes(s):!0).slice(0,70)},[fe,ze,B]),Ge=a.useMemo(()=>{if(!de?.features)return[];const s=d?.id??d?.uid??null;return de.features.map(t=>{const n=t.geometry;if(!n)return null;let j=[];if(n.type==="Polygon")j=(n.coordinates?.[0]||[]).map(([ve,je])=>typeof je=="number"&&typeof ve=="number"?{lat:je,lng:ve}:null).filter(Boolean);else if(n.type==="MultiPolygon")j=(n.coordinates?.[0]?.[0]||[]).map(([ve,je])=>typeof je=="number"&&typeof ve=="number"?{lat:je,lng:ve}:null).filter(Boolean);else return null;if(!j.length)return null;const g=t.properties||{},Z=String(g.status||"").toLowerCase();let Oe="#10b981";Z==="reserved"?Oe="#f59e0b":Z==="occupied"&&(Oe="#ef4444");const vs=g.id!=null?String(g.id):void 0,js=g.uid!=null?String(g.uid):void 0,Ns=s!=null&&(String(s)===String(vs)||String(s)===String(js)),Xe={strokeColor:Oe,strokeOpacity:1,strokeWeight:1.2,fillColor:Oe,fillOpacity:.45},Qs=B&&Z!=="available"?{strokeOpacity:.25,fillOpacity:.08}:{},Xs=Ns?{strokeColor:"#2563eb",strokeOpacity:1,strokeWeight:4,fillColor:"#60a5fa",fillOpacity:.65,zIndex:999}:{},et=s!=null&&!Ns?{strokeOpacity:Math.min(Xe.strokeOpacity,.35),fillOpacity:Math.min(Xe.fillOpacity,.14)}:{},Fe=Ls(t),st=Fe?Fe[0]:null,tt=Fe?Fe[1]:null;return{id:vs,uid:js,plot_name:g.plot_name??g.plot_code??"—",plot_type:g.plot_type??"—",size_sqm:g.size_sqm??"—",price:g.price??null,status:g.status??"—",lat:st,lng:tt,_feature:t,path:j,options:{...Xe,...Qs,...et,...Xs}}}).filter(Boolean)},[de,d,B]),D=a.useMemo(()=>d?String(d.status||"").toLowerCase()==="available":!1,[d]),xe=a.useCallback(s=>{if(!s)return null;const t=String(s);return Ge.find(n=>n?.id!=null&&String(n.id)===t)||null},[Ge]),We=a.useMemo(()=>{const s=[];return String(u.full_name||"").trim()||s.push("Your profile name"),String(u.relationship||"").trim()||s.push("Relationship to deceased"),String(u.contact_number||"").trim()||s.push("Your profile contact number (or provide one below)"),String(c.full_name||"").trim()||s.push("Deceased full name"),s},[u.full_name,u.relationship,u.contact_number,c.full_name]),v=a.useMemo(()=>String(u.full_name||"").trim().length>0&&String(u.relationship||"").trim().length>0&&String(u.contact_number||"").trim().length>0&&String(c.full_name||"").trim().length>0&&!$e&&!is&&!ns,[u.full_name,u.relationship,u.contact_number,c.full_name,$e,is,ns]),ps=a.useMemo(()=>{const s=c.date_of_death?new Date(c.date_of_death):null,t=c.date_of_burial?new Date(c.date_of_burial):null;return!s||!t||Number.isNaN(s.getTime())||Number.isNaN(t.getTime())?"":t.getTime()<s.getTime()?"Date of burial looks earlier than date of death.":""},[c.date_of_death,c.date_of_burial]),Ke=a.useMemo(()=>{const s=u||{},t=c||{},j=["Visitor (Applicant) Details",L("Full name",s.full_name),L("Relationship",s.relationship),L("Contact number",s.contact_number),L("Email",s.email),L("Address",s.address),"","Deceased Details",L("Full name",t.full_name),L("Age",t.age),L("Date of death",t.date_of_death),L("Date of burial",t.date_of_burial),L("Remarks",t.remarks)].filter(Z=>Z!==null).map(Z=>String(Z)).join(`
`).replace(/\n{3,}/g,`

`).trim(),g=String(pe||"").trim();return!j&&!g?"":j&&!g?j:!j&&g?g:`${j}

Visitor Notes
${g}`},[u,c,pe]),Us=a.useCallback(s=>{if(!s)return;if(String(s.status||"").toLowerCase()!=="available"){h.error("This plot is not available.");return}ce(s),q(null),J(null),s.lat!=null&&s.lng!=null&&(G({lat:Number(s.lat),lng:Number(s.lng)}),W(21)),h.success("Plot selected. Click Continue to confirm.")},[]),Vs=a.useCallback(s=>{if(!s)return;if(String(s.status||"").toLowerCase()!=="available"){h.error("This plot is not available.");return}ce(s),q(null),J(null),s.lat!=null&&s.lng!=null&&(G({lat:Number(s.lat),lng:Number(s.lng)}),W(21)),h.success("Plot selected. Click Continue to confirm.")},[]),Re=a.useCallback(()=>{if(!i)return h.error("Please login as visitor.");if(!v){h.error("Please complete the required details first.");return}R(2),h("Now pick an available plot on the map.")},[v,i]),Me=a.useCallback(()=>{if(!i)return h.error("Please login as visitor.");if(!v)return h.error("Please complete the required details first.");if(!d)return h.error("Pick an available plot on the map first.");if(!D)return h.error("This plot is not available anymore.");const s=xe(d.id)||d;s?.lat!=null&&s?.lng!=null&&(G({lat:Number(s.lat),lng:Number(s.lng)}),W(21)),R(3)},[D,xe,v,i,d]),De=a.useCallback(async()=>{if(!i){h.error("Please login as visitor.");return}if(!v){h.error("Please complete the required details first.");return}const s=d?.id??d?._feature?.properties?.id;if(!s){h.error("Missing plot_id.");return}Ce(!0);try{const t=await we(Ne.reservePlot,{method:"POST",headers:y,body:JSON.stringify({plot_id:s,notes:Ke||""})}),n=t?.data||t;q(n),R(4),h.success("Reservation submitted! Upload your receipt so the admin can approve."),await K(),await M()}catch(t){h.error(t?.message||"Failed to reserve plot.")}finally{Ce(!1)}},[Ke,M,K,v,i,y,d]),Ys=a.useCallback(async s=>{if(s){Ce(!0);try{await we(Ne.cancelReservation(s),{method:"PATCH",headers:l?{Authorization:`Bearer ${l}`}:{}}),h.success("Reservation cancelled."),R(1),ce(null),q(null),Se(""),J(null),G(es),W(19),await K(),await M()}catch(t){h.error(t?.message||"Failed to cancel.")}finally{Ce(!1),ke(!1),xs(null)}}},[M,K,l]),bs=a.useMemo(()=>{const s=o?.status||"";return String(s).toLowerCase()},[o]),Ae=a.useCallback(async()=>{if(!o?.id)return;const t=(await M()||_e||[]).find(n=>String(n.id)===String(o.id));t&&q(t)},[o?.id,M,_e]);a.useEffect(()=>{if(!(p!==4||!o?.id||String(o?.status||"").toLowerCase()!=="pending"))return me.current&&clearInterval(me.current),me.current=setInterval(()=>{Ae()},8e3),()=>{me.current&&clearInterval(me.current),me.current=null}},[o?.id,o?.status,Ae,p]);const ge=a.useMemo(()=>S?URL.createObjectURL(S):null,[S]);a.useEffect(()=>()=>{ge&&URL.revokeObjectURL(ge)},[ge]);const k=a.useMemo(()=>String(bs||"").toLowerCase()==="pending",[bs]),Hs=a.useCallback(async()=>{if(!i)return h.error("Login required.");if(!o?.id)return h.error("No active reservation.");if(!k)return h.error("Receipt upload is allowed only while your reservation is pending.");if(!S)return h.error("Please choose a receipt file.");if(!["image/jpeg","image/png","image/webp","application/pdf"].includes(S.type)){h.error("Only JPG, PNG, WEBP, or PDF is allowed.");return}const t=8*1024*1024;if(S.size>t){h.error("File too large. Max 8MB.");return}os(!0);try{const n=new FormData;n.append("receipt",S);const j=await we(Ne.uploadReceipt(o.id),{method:"POST",headers:l?{Authorization:`Bearer ${l}`}:{},body:n}),g=j?.data||j;q(g),h.success("Receipt uploaded! Now wait for admin approval."),await M(),J(null)}catch(n){h.error(n?.message||"Failed to upload receipt.")}finally{os(!1)}},[o?.id,k,M,i,S,l]),Le=()=>{R(1),ce(null),q(null),Se(""),cs(""),Ue(!0),J(null),G(es),W(19),ne({relationship:"",contact_number:"",address:""}),Y({full_name:"",date_of_death:"",date_of_burial:"",age:"",remarks:""});try{localStorage.removeItem(ts),Ve("Idle")}catch{}},Js=a.useCallback(s=>{q(s),R(4);const t=xe(s?.plot_id);t&&(ce(t),t.lat!=null&&t.lng!=null&&(G({lat:Number(t.lat),lng:Number(t.lng)}),W(21))),h("Opened reservation status.")},[xe]),fs=a.useCallback(()=>{const s=o?.plot_id,t=xe(s);t?(ce(t),t?.lat!=null&&t?.lng!=null&&(G({lat:Number(t.lat),lng:Number(t.lng)}),W(21)),R(2),h("Viewing plot on map.")):h.error("Plot not found on map yet.")},[o?.plot_id,xe]),Ze=d?z(d.status):null,Qe=o?z(o.status):null,$=a.useMemo(()=>{const s=o?.payment_receipt_url||o?.receipt_url||null;return Nt(s)},[o?.payment_receipt_url,o?.receipt_url]),Gs=s=>s?s.toLowerCase().includes(".pdf"):!1,gs=String(o?.status||"").toLowerCase()==="pending",Ws=String(o?.status||"").toLowerCase()==="approved",Ks=String(o?.status||"").toLowerCase()==="rejected",Zs=a.useMemo(()=>{const s=String(c.full_name||"").trim();if(s)return s;try{const t=localStorage.getItem("lastApprovedReservation");if(!t)return"";const n=JSON.parse(t);return String(n?.deceased_name||"").trim()}catch{return""}},[c.full_name]);return a.useEffect(()=>{if(!(!o?.id||String(o.status||"").toLowerCase()!=="approved"))try{localStorage.setItem("lastApprovedReservation",JSON.stringify({id:o.id,plot_id:o.plot_id,deceased_name:c.full_name||"",saved_at:new Date().toISOString()}))}catch{}},[o?.id,o?.status,o?.plot_id,c.full_name]),e.jsxs("div",{className:"relative min-h-screen font-poppins pb-24 lg:pb-0",children:[e.jsx(lt,{richColors:!0,expand:!1}),e.jsxs("div",{"aria-hidden":!0,className:"pointer-events-none fixed inset-0 -z-10",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-100 via-cyan-50 to-blue-100"}),e.jsx("div",{className:"absolute -top-24 -left-24 h-[32rem] w-[32rem] rounded-full bg-emerald-300/50 blur-3xl"}),e.jsx("div",{className:"absolute top-1/3 right-0 h-[28rem] w-[28rem] rounded-full bg-cyan-300/50 blur-3xl"}),e.jsx("div",{className:"absolute -bottom-32 left-1/4 h-[24rem] w-[24rem] rounded-full bg-blue-300/40 blur-3xl"})]}),e.jsx("section",{className:"pt-24 pb-6",children:e.jsxs("div",{className:"mx-auto w-full max-w-7xl px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-2 text-sm text-slate-500",children:[e.jsx(ws,{to:"/visitor/home",className:"hover:text-slate-700",children:"Home"})," › ",e.jsx("span",{className:"text-slate-700",children:"Reservation Wizard"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -inset-2 bg-gradient-to-br from-emerald-400/25 via-cyan-400/20 to-blue-400/25 rounded-2xl blur-xl opacity-40"}),e.jsxs(Q,{className:"relative overflow-hidden border-white/60 bg-white/80 backdrop-blur shadow-lg rounded-2xl",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-400/15 via-cyan-400/10 to-blue-400/15"}),e.jsxs(X,{className:"relative",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs(ee,{className:"text-2xl sm:text-3xl text-slate-900 flex items-center gap-2",children:["Burial Plot Reservation",e.jsx(rt,{className:"h-5 w-5 text-emerald-700"})]}),e.jsx(se,{className:"text-slate-600",children:"Visitor info → deceased details → pick plot → confirm → upload receipt → wait admin approval."}),e.jsxs("div",{className:"mt-2 text-xs text-slate-500",children:["Draft:"," ",e.jsx("span",{className:"font-semibold text-slate-700",children:us==="Idle"?"Not saved yet":us})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{type:"button",variant:"outline",onClick:K,disabled:oe,className:"rounded-xl",title:"Refresh plots",children:[e.jsx(Te,{className:["h-4 w-4 mr-2",oe?"animate-spin":""].join(" ")}),"Refresh plots"]}),e.jsxs(m,{type:"button",variant:"outline",onClick:Le,className:"rounded-xl",title:"Clear everything (also clears draft)",children:[e.jsx(it,{className:"h-4 w-4 mr-2"}),"Clear all"]})]})]}),e.jsx(yt,{step:p}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 sm:grid-cols-4 gap-2",children:[e.jsx(qe,{label:"Total plots",value:Pe.total,dotClass:"bg-slate-400"}),e.jsx(qe,{label:"Available",value:Pe.available,dotClass:"bg-emerald-500"}),e.jsx(qe,{label:"Reserved",value:Pe.reserved,dotClass:"bg-amber-400"}),e.jsx(qe,{label:"Occupied",value:Pe.occupied,dotClass:"bg-rose-500"})]}),p===2?e.jsxs("div",{className:"mt-4 flex flex-wrap items-center justify-between gap-3",children:[e.jsx(_t,{}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Tip: Click an ",e.jsx("span",{className:"font-semibold",children:"available"})," plot on the map to select it."]})]}):p===1?e.jsxs("div",{className:"mt-4 rounded-2xl border bg-white/70 p-3 text-sm text-slate-700 flex gap-2",children:[e.jsx(U,{className:"h-4 w-4 mt-0.5 text-slate-500"}),"Step 1 is required. Your visitor info is auto-filled. Please complete the deceased details and relationship."]}):p===3?e.jsxs("div",{className:"mt-4 rounded-2xl border bg-white/70 p-3 text-sm text-slate-700 flex gap-2",children:[e.jsx(U,{className:"h-4 w-4 mt-0.5 text-slate-500"}),"Step 3 is confirmation. You can still go back and edit details or change plot."]}):null]})]})]}),V?null:e.jsx("div",{className:"mt-4",children:e.jsxs(te,{variant:"destructive",className:"bg-rose-50/90 backdrop-blur border-rose-200 shadow-md rounded-2xl",children:[e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(Ds,{className:"h-4 w-4"}),"Missing API configuration"]}),e.jsxs(le,{className:"text-rose-700",children:["Set ",e.jsx("b",{children:"VITE_API_BASE_URL"})," in your frontend environment."]})]})}),!i&&e.jsx("div",{className:"mt-4",children:e.jsxs(te,{variant:"destructive",className:"bg-rose-50/90 backdrop-blur border-rose-200 shadow-md rounded-2xl",children:[e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(Ds,{className:"h-4 w-4"}),"Login required"]}),e.jsx(le,{className:"text-rose-700",children:"Please login as a visitor to reserve and upload receipts."})]})})]})}),e.jsx("section",{className:"pb-10",children:e.jsxs("div",{className:"mx-auto w-full max-w-7xl px-4 sm:px-6 lg:px-8 grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[p===1&&e.jsxs(Q,{className:"rounded-2xl overflow-hidden",children:[e.jsxs(X,{className:"pb-2",children:[e.jsxs(ee,{className:"text-lg flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-emerald-700"}),"Step 1: Visitor & deceased details"]}),e.jsx(se,{children:"Visitor info is auto-filled from your logged-in account. Please complete relationship and deceased info."})]}),e.jsxs(ue,{className:"space-y-4",children:[!v&&We.length>0?e.jsxs("div",{className:"rounded-2xl border bg-amber-50 p-3 text-sm text-amber-900",children:[e.jsx("div",{className:"font-semibold",children:"Required fields missing"}),e.jsx("div",{className:"text-xs text-amber-800 mt-1",children:We.join(", ")})]}):null,ps?e.jsxs("div",{className:"rounded-2xl border bg-amber-50 p-3 text-sm text-amber-900",children:[e.jsx("div",{className:"font-semibold",children:"Check your dates"}),e.jsx("div",{className:"text-xs text-amber-800 mt-1",children:ps})]}):null,$e?e.jsxs("div",{className:"rounded-2xl border bg-rose-50 p-3 text-sm text-rose-900",children:[e.jsx("div",{className:"font-semibold",children:"Invalid date of death"}),e.jsxs("div",{className:"text-xs text-rose-800 mt-1",children:["Date of death cannot be later than today (",N,")."]})]}):null,e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-2xl border bg-white p-4 space-y-3",children:[e.jsx("div",{className:"text-sm font-bold text-slate-900",children:"Visitor (logged-in)"}),e.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Full name"}),e.jsx("div",{className:"font-semibold text-slate-900 break-words",children:u.full_name||"—"})]}),e.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Email"}),e.jsx("div",{className:"font-semibold text-slate-900 break-words",children:u.email||"—"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(F,{children:["Relationship to deceased ",e.jsx("span",{className:"text-rose-600",children:"*"})]}),e.jsx(T,{value:O.relationship,onChange:s=>ne(t=>({...t,relationship:s.target.value})),placeholder:"Son, Daughter, Spouse, Relative",className:"rounded-xl"})]}),u._source?.hasProfilePhone?e.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Contact number"}),e.jsx("div",{className:"font-semibold text-slate-900 break-words",children:u.contact_number||"—"}),e.jsx("div",{className:"text-[11px] text-slate-500 mt-1",children:"Pulled from your profile. Update your account profile if incorrect."})]}):e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(F,{children:["Contact number ",e.jsx("span",{className:"text-rose-600",children:"*"})]}),e.jsx(T,{value:O.contact_number,onChange:s=>ne(t=>({...t,contact_number:s.target.value})),placeholder:"09xx xxx xxxx",className:"rounded-xl",inputMode:"tel"}),e.jsx("div",{className:"text-[11px] text-slate-500",children:"Your profile has no contact number. Provide one here so the admin can reach you."})]}),u._source?.hasProfileAddress?e.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Address"}),e.jsx("div",{className:"font-semibold text-slate-900 break-words",children:u.address||"—"})]}):e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(F,{children:"Address (optional)"}),e.jsx(T,{value:O.address,onChange:s=>ne(t=>({...t,address:s.target.value})),placeholder:"City, Province",className:"rounded-xl"})]}),e.jsxs("div",{className:"rounded-2xl border bg-white/70 p-3 text-sm text-slate-700 flex gap-2",children:[e.jsx(U,{className:"h-4 w-4 mt-0.5 text-slate-500"}),"Visitor fields come from your logged-in account. Relationship is required for this request."]})]}),e.jsxs("div",{className:"rounded-2xl border bg-white p-4 space-y-3",children:[e.jsx("div",{className:"text-sm font-bold text-slate-900",children:"Deceased details"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(F,{children:["Full name ",e.jsx("span",{className:"text-rose-600",children:"*"})]}),e.jsx(T,{value:c.full_name,onChange:s=>Y(t=>({...t,full_name:s.target.value})),placeholder:"Maria Dela Cruz",className:"rounded-xl"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(F,{children:"Age"}),e.jsx(T,{value:c.age,onChange:s=>Y(t=>({...t,age:s.target.value})),placeholder:"Optional",className:"rounded-xl",inputMode:"numeric"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(F,{children:"Date of death"}),e.jsx(T,{type:"date",value:c.date_of_death,max:N,onChange:s=>{const t=s.target.value;if(t&&t>N){h.error(`Date of death cannot be in the future. Max allowed is ${N}.`);return}Y(n=>({...n,date_of_death:t}))},className:"rounded-xl"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(F,{children:"Date of burial"}),e.jsx(T,{type:"date",value:c.date_of_burial,onChange:s=>Y(t=>({...t,date_of_burial:s.target.value})),className:"rounded-xl"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(F,{children:"Remarks"}),e.jsx(T,{value:c.remarks,onChange:s=>Y(t=>({...t,remarks:s.target.value})),placeholder:"Optional notes",className:"rounded-xl"})]}),e.jsxs("div",{className:"rounded-2xl border bg-white/70 p-3 text-sm text-slate-700 flex gap-2",children:[e.jsx(U,{className:"h-4 w-4 mt-0.5 text-slate-500"}),"These details will be included in the reservation notes sent to the admin."]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsx(m,{variant:"outline",className:"rounded-xl",onClick:()=>A(!0),children:"Preview details"}),e.jsxs(m,{className:"bg-emerald-600 hover:bg-emerald-700 rounded-xl",onClick:Re,disabled:!i||!v,title:i?v?"":"Complete required fields":"Login required",children:["Continue to map",e.jsx(_,{className:"h-4 w-4 ml-2"})]})]})]})]}),p===2&&e.jsxs(Q,{className:"overflow-hidden rounded-2xl",children:[e.jsxs(X,{className:"pb-2",children:[e.jsxs(ee,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-emerald-700"}),"Step 2: Pick a grave on the map"]}),e.jsxs(se,{children:["Click an ",e.jsx("span",{className:"font-semibold",children:"available"})," plot to select it. Optional: use search below."]})]}),e.jsxs(ue,{className:"space-y-3",children:[rs?e.jsxs(te,{variant:"destructive",className:"border-rose-200 rounded-2xl",children:[e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(nt,{className:"h-4 w-4"}),"Failed to load plots"]}),e.jsx(le,{className:"break-words",children:rs})]}):null,e.jsx("div",{className:"h-[60vh] rounded-2xl overflow-hidden border relative bg-white shadow-sm",children:oe?e.jsx("div",{className:"absolute inset-0 grid place-items-center text-slate-600",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5 animate-spin"}),"Loading plots…"]})}):e.jsx(dt,{center:Es,zoom:Bs,clickable:!0,showGeofence:!0,restrictToGeofence:!0,polygons:Ge,polylines:[],markers:[],onEditPlot:s=>Vs(s),showInitialRoads:!1})}),e.jsxs("div",{className:"rounded-2xl border bg-white p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"text-sm font-semibold text-slate-900 flex items-center gap-2",children:[e.jsx(ys,{className:"h-4 w-4 text-slate-700"}),"Search plots (optional)"]}),e.jsxs(m,{type:"button",variant:B?"default":"outline",size:"sm",onClick:()=>Ue(s=>!s),disabled:oe,className:"rounded-full",title:"Filter on map and list",children:["Only Available: ",B?"On":"Off"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{children:"Search"}),e.jsxs("div",{className:"relative mt-1.5",children:[e.jsx(ys,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),e.jsx(T,{value:ze,onChange:s=>cs(s.target.value),placeholder:"e.g. S7, grave_double, available…",className:"pl-9 rounded-xl",disabled:oe})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[e.jsxs("div",{children:["Showing"," ",e.jsx("span",{className:"font-semibold text-slate-700",children:Je.length})," ","result(s)"]}),oe?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(I,{className:"h-3.5 w-3.5 animate-spin"}),"Loading…"]}):null]}),e.jsx("div",{className:"max-h-[340px] overflow-auto rounded-2xl border bg-white",children:Je.length===0?e.jsx("div",{className:"p-4 text-sm text-slate-500",children:"No plots found."}):e.jsx("ul",{className:"divide-y",children:Je.map(s=>{const t=z(s.status),n=`${s.id||""}-${s.uid||""}-${s.plot_name||""}`,j=d&&(s.id&&d.id&&String(s.id)===String(d.id)||s.uid&&d.uid&&String(s.uid)===String(d.uid));return e.jsx("li",{className:["p-3 transition-all","hover:bg-slate-50",j?"bg-blue-50 ring-1 ring-blue-200/70":""].join(" "),children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-bold text-slate-900 truncate",children:s.plot_name??"—"}),j?e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-blue-100 text-blue-700 border border-blue-200",children:"Selected"}):null]}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1 flex flex-wrap items-center gap-x-2 gap-y-1",children:[e.jsx("span",{className:"inline-flex items-center rounded-full border bg-white px-2 py-0.5",children:s.plot_type??"—"}),e.jsxs("span",{className:"inline-flex items-center rounded-full border bg-white px-2 py-0.5",children:[s.size_sqm??"—"," sqm"]}),e.jsxs("span",{className:"inline-flex items-center rounded-full border bg-white px-2 py-0.5 font-semibold text-slate-700",children:["₱",Ie(s.price)]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx(re,{className:t.className,children:t.label}),e.jsx(m,{type:"button",size:"sm",className:"rounded-xl",onClick:()=>Us(s),disabled:!i||String(s.status||"").toLowerCase()!=="available",title:i?"":"Login required",children:"Select"})]})]})},n)})})}),e.jsxs("div",{className:"rounded-2xl border bg-white/70 p-3 text-sm text-slate-700 flex gap-2",children:[e.jsx(U,{className:"h-4 w-4 mt-0.5 text-slate-500"}),"Select by clicking the map or selecting from the list. Then press Continue."]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs(m,{variant:"outline",className:"rounded-xl",onClick:()=>R(1),children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"Back to details"]}),e.jsxs(m,{className:"bg-emerald-600 hover:bg-emerald-700 rounded-xl",onClick:Me,disabled:!d||!D||!i,title:i?d?"":"Select a plot":"Login required",children:["Continue",e.jsx(_,{className:"h-4 w-4 ml-2"})]})]})]})]})]}),p===3&&e.jsxs(Q,{className:"rounded-2xl overflow-hidden",children:[e.jsxs(X,{className:"pb-2",children:[e.jsxs(ee,{className:"text-lg flex items-center gap-2",children:[e.jsx(as,{className:"h-5 w-5 text-emerald-700"}),"Step 3: Confirm and submit"]}),e.jsx(se,{children:"Review your details and selected plot, then submit your reservation."})]}),e.jsx(ue,{className:"space-y-3",children:v?d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-2xl border bg-white p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Visitor (Applicant)"}),e.jsx("div",{className:"text-base font-bold text-slate-900 truncate",children:u.full_name||"—"}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[u.relationship||"—"," • ",u.contact_number||"—"]})]}),e.jsx(m,{variant:"outline",className:"rounded-xl",onClick:()=>R(1),disabled:C,children:"Edit details"})]}),e.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3 text-sm",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Deceased"}),e.jsx("div",{className:"font-semibold text-slate-900",children:c.full_name||"—"}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:c.date_of_death?`Date of death: ${c.date_of_death}`:"Date of death: —"}),e.jsx("div",{className:"text-xs text-slate-600",children:c.date_of_burial?`Date of burial: ${c.date_of_burial}`:"Date of burial: —"})]})]}),e.jsxs("div",{className:"rounded-2xl border bg-white p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Selected plot"}),e.jsx("div",{className:"text-base font-bold text-slate-900 truncate",children:d.plot_name??"—"}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[d.plot_type??"—"," • ",d.size_sqm??"—"," sqm • ₱",Ie(d.price)]})]}),e.jsx(re,{className:z(d.status).className,children:z(d.status).label})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsxs(m,{variant:"outline",className:"rounded-xl",onClick:()=>R(2),disabled:C,children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"Change plot"]}),e.jsxs(m,{className:"rounded-xl",onClick:()=>A(!0),disabled:!d,children:["View preview",e.jsx(_,{className:"h-4 w-4 ml-2"})]})]}),D?null:e.jsx("div",{className:"mt-3 text-xs text-amber-700",children:"This plot is not available anymore. Please go back and pick another."})]}),e.jsxs("div",{className:"rounded-2xl border bg-white p-4",children:[e.jsx("div",{className:"text-sm font-bold text-slate-900",children:"Extra notes (optional)"}),e.jsx("div",{className:"text-xs text-slate-500 mt-0.5",children:"Your visitor/deceased details are included automatically in the notes sent to the admin."}),e.jsx("textarea",{value:pe,onChange:s=>Se(s.target.value),placeholder:"Optional extra notes...",disabled:!i||C,className:"mt-3 w-full min-h-[120px] rounded-2xl border bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-emerald-200"}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-2",children:[e.jsxs(m,{variant:"outline",className:"rounded-xl",onClick:()=>R(2),disabled:C,children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsx(m,{className:"bg-emerald-600 hover:bg-emerald-700 rounded-xl",onClick:De,disabled:!i||C||!D,children:C?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 animate-spin"}),"Submitting…"]}):e.jsxs(e.Fragment,{children:["Submit",e.jsx(_,{className:"h-4 w-4 ml-2"})]})})]})]})]}):e.jsxs(te,{variant:"destructive",className:"border-rose-200 rounded-2xl",children:[e.jsx(ae,{children:"Select a plot first"}),e.jsx(le,{children:"Please go back to Step 2 and pick on the map."})]}):e.jsxs(te,{variant:"destructive",className:"border-rose-200 rounded-2xl",children:[e.jsx(ae,{children:"Complete details first"}),e.jsx(le,{children:"Please go back to Step 1 and fill the required fields."})]})})]}),p===4&&e.jsxs(Q,{className:"rounded-2xl overflow-hidden",children:[e.jsxs(X,{className:"pb-2",children:[e.jsxs(ee,{className:"text-lg flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-emerald-700"}),"Step 4: Upload receipt & wait approval"]}),e.jsxs(se,{children:["Upload your receipt while status is ",e.jsx("b",{children:"Pending"}),". Admin will review and approve after."]})]}),e.jsx(ue,{className:"space-y-3",children:o?e.jsxs(e.Fragment,{children:[e.jsx(St,{status:o?.status,hasReceipt:!!$}),e.jsxs("div",{className:"rounded-2xl border bg-white p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Reservation"}),e.jsxs("div",{className:"text-base font-bold text-slate-900",children:["#",o.id]}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Plot:"," ",e.jsx("span",{className:"font-semibold text-slate-700",children:o.plot_code||d?.plot_name||"—"})]}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Created: ",String(o.created_at||"").slice(0,10)||"—"]})]}),Qe?e.jsx(re,{className:Qe.className,children:Qe.label}):null]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs(m,{variant:"outline",onClick:Ae,disabled:H,className:"rounded-xl",children:[e.jsx(Te,{className:["h-4 w-4 mr-2",H?"animate-spin":""].join(" ")}),"Refresh"]}),e.jsxs(m,{variant:"outline",onClick:fs,className:"rounded-xl",disabled:!o?.plot_id,title:o?.plot_id?"View on map":"Missing plot_id",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"View on map"]}),e.jsx(m,{variant:"destructive",onClick:()=>{xs(o.id),ke(!0)},disabled:C,className:"rounded-xl",title:"Cancel this reservation",children:"Cancel"})]}),gs&&!$?e.jsxs("div",{className:"mt-3 rounded-2xl border bg-amber-50 p-3 text-sm text-amber-900",children:[e.jsxs("div",{className:"flex items-center gap-2 font-semibold",children:[e.jsx(U,{className:"h-4 w-4"}),"Action needed: Upload your receipt"]}),e.jsx("div",{className:"text-xs text-amber-800 mt-1",children:"Your reservation is pending. Upload your payment receipt so the admin can review and approve."})]}):null,gs&&$?e.jsxs("div",{className:"mt-3 rounded-2xl border bg-amber-50 p-3 text-sm text-amber-900",children:[e.jsxs("div",{className:"flex items-center gap-2 font-semibold",children:[e.jsx(I,{className:"h-4 w-4 animate-spin"}),"Waiting for Admin Approval"]}),e.jsx("div",{className:"text-xs text-amber-800 mt-1",children:"Receipt received. Auto-refresh runs every ~8 seconds while pending."})]}):null,Ws?e.jsxs("div",{className:"mt-3 rounded-2xl border bg-emerald-50 p-3 text-sm text-emerald-900",children:[e.jsxs("div",{className:"flex items-center gap-2 font-semibold",children:[e.jsx(Os,{className:"h-4 w-4"}),"Approved by Admin ✅"]}),e.jsx("div",{className:"text-xs text-emerald-800 mt-1",children:"Your reservation has been approved. You may now proceed to create your burial request."}),e.jsx("div",{className:"mt-3",children:e.jsx(m,{asChild:!0,className:"bg-emerald-600 hover:bg-emerald-700 rounded-xl",children:e.jsxs(ws,{to:wt({plotId:o.plot_id,reservationId:o.id,deceasedName:Zs}),children:["Proceed to Burial Request",e.jsx(_,{className:"h-4 w-4 ml-2"})]})})})]}):null,Ks?e.jsxs("div",{className:"mt-3 rounded-2xl border bg-rose-50 p-3 text-sm text-rose-900",children:[e.jsx("div",{className:"font-semibold",children:"Rejected"}),e.jsx("div",{className:"text-xs text-rose-800 mt-1",children:"Please contact the admin for details or create a new reservation."})]}):null]}),e.jsxs("div",{className:"rounded-2xl border bg-white p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-bold text-slate-900 flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-slate-700"}),"Payment Receipt"]}),e.jsxs("div",{className:"text-xs text-slate-500 mt-0.5",children:["Upload JPG, PNG, WEBP, or PDF (max 8MB). Upload is enabled while status is ",e.jsx("b",{children:"Pending"}),"."]})]}),e.jsx(re,{className:k?"bg-emerald-600 hover:bg-emerald-600":"bg-slate-500 hover:bg-slate-500",children:k?"Enabled":"Disabled"})]}),$?e.jsxs("div",{className:"mt-3 rounded-2xl border bg-slate-50 p-3",children:[e.jsx("div",{className:"text-xs text-slate-600 font-semibold mb-2",children:"Uploaded receipt"}),Gs($)?e.jsxs("a",{href:$,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 text-sm text-blue-700 hover:underline",children:[e.jsx(Ms,{className:"h-4 w-4"}),"View PDF receipt"]}):e.jsx("a",{href:$,target:"_blank",rel:"noreferrer",children:e.jsx("img",{src:$,alt:"Payment receipt",className:"w-full max-h-[260px] object-contain rounded-xl border bg-white"})}),k?e.jsx("div",{className:"mt-2 text-xs text-slate-500",children:"Need to replace it? Select a new file below and upload again."}):null]}):null,e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{role:"button",tabIndex:0,onClick:()=>{!k||E||Ye.current?.click()},onKeyDown:s=>{if(s.key==="Enter"||s.key===" "){if(s.preventDefault(),!k||E)return;Ye.current?.click()}},onDragOver:s=>{s.preventDefault(),!(!k||E)&&He(!0)},onDragLeave:()=>He(!1),onDrop:s=>{if(s.preventDefault(),He(!1),!k||E)return;const t=s.dataTransfer.files?.[0]||null;hs(t)},className:["rounded-2xl border p-4 transition-all","bg-white",k?"cursor-pointer hover:shadow-sm":"opacity-60 cursor-not-allowed",$s?"ring-2 ring-emerald-200 border-emerald-300 bg-emerald-50/40":"border-slate-200"].join(" "),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-11 w-11 rounded-2xl border bg-slate-50 grid place-items-center",children:e.jsx(ye,{className:"h-5 w-5 text-slate-700"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Drag and drop your receipt"}),e.jsx("div",{className:"text-xs text-slate-500",children:"or click to browse (JPG, PNG, WEBP, or PDF, max 8MB)"})]})]})}),e.jsx("input",{ref:Ye,type:"file",className:"hidden",accept:"image/jpeg,image/png,image/webp,application/pdf",disabled:!k||E,onChange:s=>hs(s.target.files?.[0]||null)}),S?e.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 font-semibold text-slate-800 min-w-0",children:[S.type==="application/pdf"?e.jsx(Ms,{className:"h-4 w-4 shrink-0"}):e.jsx(ut,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{className:"truncate",children:S.name})]}),e.jsx(m,{type:"button",variant:"outline",size:"sm",className:"rounded-xl",onClick:()=>J(null),disabled:E,children:"Remove"})]}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[(S.size/1024/1024).toFixed(2)," MB"]}),ge&&S.type!=="application/pdf"?e.jsx("img",{src:ge,alt:"Preview",className:"mt-2 w-full max-h-[260px] object-contain rounded-xl border bg-white"}):null]}):null,e.jsx(m,{className:"w-full bg-emerald-600 hover:bg-emerald-700 rounded-xl",onClick:Hs,disabled:!k||E||!S,children:E?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 animate-spin"}),"Uploading…"]}):"Upload Receipt"}),k?null:e.jsx("p",{className:"text-xs text-slate-500",children:"Receipt upload is disabled once the reservation is not pending (e.g., approved/rejected/cancelled)."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsx(m,{variant:"outline",onClick:Le,className:"rounded-xl",children:"New reservation"}),e.jsx(m,{onClick:()=>A(!0),className:"rounded-xl",children:"View preview"})]})]}):e.jsxs(te,{className:"rounded-2xl",children:[e.jsx(ae,{children:"No active reservation"}),e.jsx(le,{children:"Submit a reservation first to upload payment and wait for approval."})]})})]})]}),e.jsxs("div",{className:"space-y-4 lg:sticky lg:top-24 h-fit",children:[e.jsxs(Q,{className:"rounded-2xl overflow-hidden",children:[e.jsxs(X,{className:"pb-2",children:[e.jsx(ee,{className:"text-lg",children:p===1?"Enter details":p===2?"Pick a grave":p===3?"Confirm and submit":"Quick actions"}),e.jsx(se,{children:p===1?"Visitor is auto-filled. Complete relationship & deceased details.":p===2?"Select an available plot on the map, then continue.":p===3?"Review and submit your reservation.":"Upload receipt while pending and wait for approval."})]}),e.jsxs(ue,{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-2xl border bg-white p-3 space-y-2",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Visitor"}),e.jsx("div",{className:"text-sm font-bold text-slate-900 truncate",children:u.full_name||"Not set"}),e.jsxs("div",{className:"text-xs text-slate-500",children:[u.relationship||"Relationship: —"," • ",u.contact_number||"Contact: —"]}),e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Deceased"}),e.jsx("div",{className:"text-sm font-bold text-slate-900 truncate",children:c.full_name||"Not set"})]}),v?null:e.jsxs("div",{className:"rounded-2xl border bg-amber-50 p-2 text-xs text-amber-900",children:["Required fields missing: ",We.join(", ")]})]}),e.jsxs("div",{className:"rounded-2xl border bg-white p-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Selected Plot"}),e.jsx("div",{className:"text-sm font-bold text-slate-900 truncate",children:d?.plot_name||"None"}),e.jsx("div",{className:"text-xs text-slate-500",children:d?`${d.plot_type} • ${d.size_sqm} sqm • ₱${Ie(d.price)}`:"Pick an available plot on the map."})]}),Ze?e.jsx(re,{className:Ze.className,children:Ze.label}):null]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsx(m,{variant:"outline",onClick:()=>A(!0),className:"rounded-xl",children:"View"}),p===1?e.jsxs(m,{className:"bg-emerald-600 hover:bg-emerald-700 rounded-xl",onClick:Re,disabled:!i||!v,children:["Continue",e.jsx(_,{className:"h-4 w-4 ml-2"})]}):p===2?e.jsxs(m,{className:"bg-emerald-600 hover:bg-emerald-700 rounded-xl",onClick:Me,disabled:!d||!D||!i||!v,children:["Continue",e.jsx(_,{className:"h-4 w-4 ml-2"})]}):p===3?e.jsx(m,{className:"bg-emerald-600 hover:bg-emerald-700 rounded-xl",onClick:De,disabled:!i||C||!D||!v||!d,children:C?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 animate-spin"}),"Submitting…"]}):e.jsxs(e.Fragment,{children:["Submit",e.jsx(_,{className:"h-4 w-4 ml-2"})]})}):e.jsxs(m,{className:"bg-emerald-600 hover:bg-emerald-700 rounded-xl",onClick:Le,children:["New",e.jsx(_,{className:"h-4 w-4 ml-2"})]})]})]}),p===4&&o?e.jsxs("div",{className:"rounded-2xl border bg-white p-3",children:[e.jsxs("div",{className:"text-sm font-bold text-slate-900",children:["Active reservation #",o.id]}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["Status:"," ",e.jsx("span",{className:"font-semibold text-slate-700",children:String(o.status||"—")})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsxs(m,{variant:"outline",onClick:Ae,disabled:H,className:"rounded-xl",children:[e.jsx(Te,{className:["h-4 w-4 mr-2",H?"animate-spin":""].join(" ")}),"Refresh"]}),e.jsxs(m,{variant:"outline",onClick:fs,className:"rounded-xl",disabled:!o?.plot_id,children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Map"]})]})]}):null]})]}),e.jsxs(Q,{className:"rounded-2xl",children:[e.jsx(X,{className:"pb-2",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx(ee,{className:"text-lg",children:"My Reservations"}),e.jsx(se,{children:"Open a reservation to check status"})]}),i?e.jsx(m,{type:"button",variant:"ghost",size:"sm",className:"h-9 px-2 rounded-xl",onClick:M,disabled:H,title:"Refresh",children:e.jsx(Te,{className:["h-4 w-4",H?"animate-spin":""].join(" ")})}):null]})}),e.jsx(ue,{className:"space-y-3",children:i?H?e.jsxs("div",{className:"text-sm text-slate-600 flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 animate-spin"}),"Loading…"]}):_e.length===0?e.jsx("div",{className:"text-sm text-slate-500",children:"No reservations yet."}):e.jsx("div",{className:"space-y-2",children:_e.slice(0,8).map(s=>{const t=z(s.status);return e.jsx("button",{type:"button",className:"w-full text-left rounded-2xl border bg-white p-3 hover:bg-slate-50 transition",onClick:()=>Js(s),children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-sm font-bold text-slate-900 truncate",children:[s.plot_code||"Plot"," • Reservation #",s.id]}),e.jsxs("div",{className:"text-xs text-slate-500 mt-0.5",children:["Created: ",String(s.created_at||"").slice(0,10)||"—"]})]}),e.jsx(re,{className:t.className,children:t.label})]})},s.id)})}):e.jsx("div",{className:"text-sm text-slate-600",children:"Login to view your reservations."})})]})]})]})}),e.jsx("div",{className:"fixed bottom-3 left-0 right-0 z-40 px-4 lg:hidden",children:e.jsx("div",{className:"mx-auto max-w-3xl rounded-2xl border bg-white/80 backdrop-blur shadow-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-[11px] text-slate-500",children:p===1?"Visitor":"Selected"}),e.jsx("div",{className:"text-sm font-semibold text-slate-900 truncate",children:p===1?u.full_name||"Not set":d?.plot_name||"None"})]}),p===1?e.jsxs(m,{className:"bg-emerald-600 hover:bg-emerald-700 rounded-xl",onClick:Re,disabled:!i||!v,children:["Continue",e.jsx(_,{className:"h-4 w-4 ml-2"})]}):p===2?e.jsxs(m,{className:"bg-emerald-600 hover:bg-emerald-700 rounded-xl",onClick:Me,disabled:!d||!D||!i||!v,children:["Continue",e.jsx(_,{className:"h-4 w-4 ml-2"})]}):p===3?e.jsx(m,{className:"bg-emerald-600 hover:bg-emerald-700 rounded-xl",onClick:De,disabled:!i||C||!D||!v||!d,children:C?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 animate-spin"}),"Submitting…"]}):e.jsxs(e.Fragment,{children:["Submit",e.jsx(_,{className:"h-4 w-4 ml-2"})]})}):e.jsxs(m,{variant:"outline",className:"rounded-xl",onClick:Le,children:["New",e.jsx(_,{className:"h-4 w-4 ml-2"})]})]})})}),e.jsx(_s,{open:Is,onOpenChange:A,children:e.jsxs(Ss,{className:"sm:max-w-[640px]",children:[e.jsxs(Cs,{children:[e.jsx(ks,{children:"Reservation Preview"}),e.jsx(Ps,{children:"Review visitor/deceased details and selected plot."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-2xl border bg-white p-3 space-y-2",children:[e.jsx("div",{className:"text-sm font-bold text-slate-900",children:"Visitor (Applicant)"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Full name"}),e.jsx("div",{className:"font-semibold text-slate-900",children:u.full_name||"—"})]}),e.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Relationship"}),e.jsx("div",{className:"font-semibold text-slate-900",children:u.relationship||"—"})]}),e.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Contact number"}),e.jsx("div",{className:"font-semibold text-slate-900",children:u.contact_number||"—"})]}),e.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Email"}),e.jsx("div",{className:"font-semibold text-slate-900",children:u.email||"—"})]})]}),e.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Address"}),e.jsx("div",{className:"font-semibold text-slate-900 break-words",children:u.address||"—"})]})]}),e.jsxs("div",{className:"rounded-2xl border bg-white p-3 space-y-2",children:[e.jsx("div",{className:"text-sm font-bold text-slate-900",children:"Deceased"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Full name"}),e.jsx("div",{className:"font-semibold text-slate-900",children:c.full_name||"—"})]}),e.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Age"}),e.jsx("div",{className:"font-semibold text-slate-900",children:c.age||"—"})]}),e.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Date of death"}),e.jsx("div",{className:"font-semibold text-slate-900",children:c.date_of_death||"—"})]}),e.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Date of burial"}),e.jsx("div",{className:"font-semibold text-slate-900",children:c.date_of_burial||"—"})]})]}),e.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Remarks"}),e.jsx("div",{className:"font-semibold text-slate-900 break-words",children:c.remarks||"—"})]})]}),e.jsxs("div",{className:"rounded-2xl border bg-white p-3 space-y-2",children:[e.jsx("div",{className:"text-sm font-bold text-slate-900",children:"Selected plot"}),d?e.jsxs("div",{className:"rounded-2xl border bg-white p-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-bold text-slate-900",children:d.plot_name??"—"}),e.jsxs("div",{className:"text-sm text-slate-600",children:[d.plot_type??"—"," • ",d.size_sqm??"—"," sqm"]})]}),e.jsx(re,{className:z(d.status).className,children:z(d.status).label})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Price"}),e.jsxs("div",{className:"font-bold text-slate-900",children:["₱",Ie(d.price)]})]}),e.jsxs("div",{className:"rounded-2xl border bg-slate-50 p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Type"}),e.jsx("div",{className:"font-bold text-slate-900",children:d.plot_type??"—"})]})]})]}):e.jsxs(te,{className:"rounded-2xl",children:[e.jsx(ae,{children:"No plot selected"}),e.jsx(le,{children:"Please select an available plot on the map."})]})]}),e.jsxs("div",{className:"rounded-2xl border bg-white p-3 text-sm text-slate-700",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Notes that will be sent"}),e.jsx("pre",{className:"whitespace-pre-wrap break-words text-slate-700 text-xs",children:Ke||"—"})]})]}),e.jsxs(Rs,{className:"gap-2 sm:gap-0",children:[e.jsx(m,{variant:"outline",onClick:()=>A(!1),className:"rounded-xl",children:"Close"}),p===1?e.jsxs(m,{onClick:()=>{A(!1),Re()},disabled:!i||!v,className:"rounded-xl",children:["Continue to map",e.jsx(_,{className:"h-4 w-4 ml-2"})]}):p===2?e.jsxs(m,{onClick:()=>{A(!1),Me()},disabled:!d||!i||!D||!v,className:"rounded-xl",children:["Continue",e.jsx(_,{className:"h-4 w-4 ml-2"})]}):p===3?e.jsx(m,{className:"bg-emerald-600 hover:bg-emerald-700 rounded-xl",onClick:()=>{A(!1),De()},disabled:!i||C||!D||!d||!v,children:"Submit reservation"}):e.jsx(m,{onClick:()=>A(!1),className:"rounded-xl",children:"Okay"})]})]})}),e.jsx(_s,{open:qs,onOpenChange:ke,children:e.jsxs(Ss,{className:"sm:max-w-[520px]",children:[e.jsxs(Cs,{children:[e.jsx(ks,{children:"Cancel reservation?"}),e.jsx(Ps,{children:"This will cancel the selected reservation and free the plot for others (if the backend allows it)."})]}),e.jsxs("div",{className:"rounded-2xl border bg-amber-50 p-3 text-sm text-amber-900",children:[e.jsx("div",{className:"font-semibold",children:"Are you sure?"}),e.jsx("div",{className:"text-xs text-amber-800 mt-1",children:"If you already paid, contact the admin before cancelling."})]}),e.jsxs(Rs,{className:"gap-2 sm:gap-0",children:[e.jsx(m,{variant:"outline",onClick:()=>ke(!1),className:"rounded-xl",children:"Keep reservation"}),e.jsx(m,{variant:"destructive",onClick:()=>Ys(ms),disabled:C||!ms,className:"rounded-xl",children:C?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 animate-spin"}),"Cancelling…"]}):"Yes, cancel"})]})]})})]})}export{Pt as default};
